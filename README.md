71
 
```
72
​
73
### Вариант 2. NPM для Memory Service
74
1. Убедитесь, что PostgreSQL запущен и доступен согласно переменным окружения (`.env.example`). Удобнее всего использовать Docker Compose из предыдущего пункта.
75
2. Установите зависимости:
76
 ```bash
77
 cd scripts
78
 npm ci
79
 ```
80
3. Проверьте соединение с базой данных:
81
 ```bash
82
 npm run test:connection
83
 ```
84
4. Запустите сервис локально:
85
 ```bash
86
 npm run start
87
 ```
88
5. Дополнительно можно выполнить тесты (`npm test`) перед коммитом.
89
​
90
## Инфраструктурные проверки
91
Для автоматической проверки готовности стека добавлен сценарий `infra/tests/stack-health-check.sh`.
92
Он поднимает docker-compose из `infra/docker-compose.yml`, ожидает статуса `healthy` для
93
`postgres`, `n8n` и `ai-memory-service`, а затем останавливает и очищает ресурсы (`docker compose down --volumes --remove-orphans`).
94
​
95
### Ограничения и переменные окружения
96
- Таймаут ожидания по умолчанию составляет 300 секунд и задаётся переменной `STACK_HEALTH_TIMEOUT`.
97
- Интервал между проверками — 5 секунд (`STACK_HEALTH_INTERVAL`).
98
- Список контролируемых сервисов задаётся через `STACK_HEALTH_SERVICES`.
99
- Для запуска требуется установленный Docker и плагин Docker Compose 2.20+.
100
- По умолчанию используется файл переменных `.env.test`; его можно переопределить через `ENV_FILE`.
101
​
102
Подробнее см. `infra/tests/README.md`.
103
​
104
### Интеграционные тесты
105
- **Назначение.** Проверяют, что скрипт инициализации `config/postgres/init.sql` создаёт все таблицы и индексы в «живой» базе.
106
- **Требования.** Локально и в CI должен быть доступен Docker с правами на запуск контейнеров. Тест сам разворачивает временный `postgres:16-alpine` и очищает его после выполнения.
107
- **Локальный запуск.**
108
  ```bash
109
  cd scripts
110
  npm run test:integration
111
  ```
112
- **Полный прогон.** Команда `npm test` теперь запускает юнит-, смоук-, e2e- и интеграционные тесты последовательно.
113
- **CI.** Для GitHub Actions используйте runner `ubuntu-latest` (Docker доступен по умолчанию) и добавьте шаг `npm run test:integration` либо общий `npm test`.
114
​
115
## Сервисы и ссылки
116
### Docker Hub
117
- [postgres:15-alpine](https://hub.docker.com/_/postgres)
118
- [n8nio/n8n:latest](https://hub.docker.com/r/n8nio/n8n)